Γενικές Πληροφορίες/Αρχιτεκτονική του Project	
	
Στο φάκελο του παραδοτέου βρίσκεται ο Aggegator Manager,
ο Software Agent του πρώτου παραδοτέου προσαρμοσμένος στις απαιτήσεις της
άσκησης ως web client, το DatabaseDescription που περιγράφει το σχεδιασμό της
βάσης και το παρόν readme.
Ως μοντέλο για το σχεδιασμό των δύο projects, την επιλογή του server και των
depedencies στα maven projects χρησιμοποιήθηκε ο κώδικας του φροντιστηρίου που
έγινε για την άσκηση. Τόσο ο Software Agent όσο και ο Aggregator Manager μπορούν
να εκτελεστούν μέσω terminal με τις εντολές sudo mvn clean install και 
sudo mvn exec:java, εφόσον έχουμε εγκατεστημένο maven στον υπολογιστή μας. 
Ως server έχουμε χρησιμοποιήσει  τον grizzly glassfish, για το GUI java swing,
για σύνδεση στη βάση JDBC, XML parser έχουμε υλοποιήσει δικό μας προσαρμοσμένο 
στις απαιτήσεις της άσκησης και ως API για τις REST υπηρεσίες χρησιμοποιούμε Jersey.
Ο Aggregator Manager είναι server που υλοποιεί τα services που περιγράφονται 
στην εκφώνηση. Ειδικότερα, το register service λαμβάνει τις αιτήσεις σύνδεσης 
των Software Agents και στέλνει την κατάλληλη απάντηση ανάλογα με το κουμπί που
θα πατηθεί από το γραφικό. Το request service περιμένει για αιτήματα από τους 
συνδεδεμένους SA, ώστε να λάβουν τις δουλειές που προορίζονται για αυτούς. 
Επιστρέφει σε μορφή json string όλες τις δουλειές που προορίζονται για τον SA 
που έκανε το αίτημα. Tέλος, το result service περιμένει να λάβει αποτέλεσμα που
στέλνει κάποιος SA και τα στέλνει στον parser, ώστε να τα τροποποιήσει σε φιλική
μορφή προς το χρήστη. Ακόμα, στέλνει μία απάντηση στον SA, ώστε να γνωρίζει ότι
ελήφθησαν τα αποτελέσματα που έστειλε. Στον AM έχει υλοποιηθεί μια μνήμη cache
που σκοπό έχει να αποφεύγονται οι συνεχείς ερωτήσεις στη βάση. 
Περιέχει την PendingQueue, που κρατάει τους SA που περιμένουν έγκριση ή απόρριψη
της αίτησης για σύνδεση, την RegisteredAgents, που κρατάει τους SA των οποίων η 
αίτηση εγκρίθηκε, την JobQueue, που κρατάει τις εντολές που θα σταλούν στους SA 
και την ResultQueue, που κρατάει τα αποτελέσματα που επιστρέφουν οι SA από τις 
εντολές που εκτέλεσαν. Παράλληλα με την cache ενημερώνεται και η βάση, που 
αποτελεί το αρχείο των εκτελέσεων μας. Τέλος, υπάρχει και γραφικό κομμάτι στο 
server. Αρχικά, βλέπουμε το login για την ταυτοποίηση του διαχειριστή του server. 
Εφόσον ο διαχειριστής συνδεθεί, παρουσιάζεται το βασικό panel με τις δυνατότητες
που έχει το πρόγραμμα. Πατώντας το κουμπί “Accept/Deny” παρουσιάζεται μια λίστα
με τους SA που περιμένουν απάντηση, καθώς και τα κουμπιά “Accept” και “Deny” για
έγκριση ή απόρριψη τους. Πατώντας το  κουμπί “Get Status” παρουσιάζονται δύο 
λίστες, μία για τους Online και μία για τους Offline agents , καθώς και κουμπιά 
για τον τερματισμό της λειτουργίας κάποιου Agent. Πατώντας το κουμπί “Create Job” 
εμφανίζεται ένα παράθυρο στο οποίο ο χρήστης μπορεί να δημιουργήσει και να 
στείλει μια nmap εντολη σε κάποιον SA. Πατώντας το κουμπί “Delete periodic” 
παρουσιάζονται σε μια λίστα όλες οι περιοδικές εντολές στη μορφή 
“id εντολής : εντολή : SA που εκτελεί την εντολή” καθώς και κουμπί για να 
διαγράψει ο χρήστης κάποια από αυτές. Τέλος, πατώντας το κουμπί “See output” 
ο χρήστης μπορεί να επιλέξει στο παράθυρο που ανοίγει να του εμφανιστούν 
αποτελέσματα από κάποιον SA (ή από όλους) και για πόσο χρονικό διάστημα. 
Με μηδέν του εμφανίζονται όλα τα αποτελέσματα ανεξάρτητα από το χρόνο στον οποίο
ελήφθησαν. Κλείνοντας το βασικό panel ολοκληρώνεται και η εκτέλεση του προγράμματος.


Αλλαγές στο 1ο παραδοτέο/Software Agent
	
O SoftwareAgent, πλέον αποτελεί έναν jersey client. Όπως ζητήθηκε, κατά την 
έναρξή του δημιουργεί τις απαιτούμενες πληροφορίες που πρέπει να δοθούν στον 
AggregatorManager/server τα οποία  στέλνει δημιουργώντας μία JSON string από 
ένα αντικείμενο τύπου Registration στο path "../register". Το BASE_URI που 
χρησιμοποιεί ο client διαβάζεται από το property file μαζί με παραμέτρους όπως 
ο αριθμός των one time threads που δημιουργεί, η μέγιστη “αδράνεια” του thread 
που διαχειρίζεται την αποστολή των αποτελεσμάτων και ο χρόνος μεταξύ δύο 
διαδοχικών αιτημάτων προς τον server (είτε αυτά αποτελούν προσπάθεια σύνδεσης 
σε αυτόν είτε αίτημα για αποστολή από τον server των jobs που έχουν καταχωρηθεί 
για εκείνον).
Αίτημα για σύνδεση στέλνεται επανειλημμένως ανά χρόνο που διαβάζεται από το 
property file έως ότου ο client γίνει δεκτός από τον server. 
Στη συνέχεια ο client εκκινεί όλα τα one-time threads και το sender thread 
και ξεκινάει στέλνοντας συνεχώς αιτήματα για τα nmap jobs που του έχουν τυχόν 
ανατεθεί. Κάθε γραμμή από την απάντηση η οποιά φτάνει στον client περιέχει μία 
JSON formatted string η οποία γίνεται parsed και το job εισάγεται σε ουρά 
ή εκκινείται περιοδικό thread κατά τα γνωστά. Σε περίπτωση που οι παράμετροι του 
αφιχθέντος job είναι “Stop”, δηλαδή   ο server ενημερώνει τον Agent ότι πρέπει 
να σταματήσει την εκτέλεση μίας περιοδικής εντολής, αναζητείται στην 
PeriodicQueue (ουρά η οποία περιέχει όλα τα periodic threads που έχουν εκκινηθεί) 
το thread που εκτελεί την δουλεία με το δοθέν id και εκείνο διακόπτεται.
Σε περίπτωση που το job είναι της μορφής (-1,exit(0),true,-1), καλείται το 
ExitingThread η λειτουργία του οποίου είναι παρόμοια με εκείνη του ShutdownHook. 
Αρχικά διαβάζει την ProcessQueue (ουρά η οποία περιέχει τις nmap processes που 
τρέχουν εκείνη τη στιγμή) και καλεί την destroy() για κάθε μία από αυτές και στη 
συνέχεια την ThreadQueue (βλ. Παραδοτέο 1) ώστε να διακόψει τα running threads.
Σε όλα τα αιτήματα προς τον server αντιμετωπίζεται το ενδεχόμενο ο server 
να είναι down. Αν συμβαίνει εμφανίζεται μήνυμα και το αποτυχημένο αίτημα 
επαναλαμβάνεται μετά από προκαθορισμένο χρόνο. Σημειώνεται ότι ο ShutdownHook 
του πρώτου παραδοτέου υφίσταται ακόμα καθαρά και μόνο για διευκόλυνση παρόλο που 
δεν χρειάζεται στο 2ο παραδοτέο.
Τα αιτήματα για την λήψη των jobs στέλνονται στο path 
"../request/(hashkey του Agent)" ενώ η αποστολή του XML output κάποιου nmap job 
που εκτελέστηκε στέλνεται στο
"../result/(hashkey του Agent που εκτέλεσε το job)/(job id)".


Maven Dependencies που χρησιμοποιήθηκαν
	
com.sun.jersey/jersey-grizzly2/1.19	στον AggregatorManager, 
                                    για τον server που χρησιμοποιείται.
	
com.sun.jersey/jersey-client/1.8	στον SoftwareAgent,
                                    για την μετατροπή του σε jersey client.

mysql/mysql-connector-java/5.1.6	στον AggregatorManager,
                                    για την σύνδεση στη βάση.
	
com.googlecode.json-simple/json-simple/1.1	σε server και client για parsing των
                                            JSON Strings (Registration,NmapJob).

com.google.code.gson/gson/2.1	στον AggregatorManager για τη δημιουργία JSON
                                string κατά την αποστολή nmap job 
                                (δημιουργία 1 JSON string για κάθε NmapJob)
                                και στον SA για τη δημιουργία JSON string της 
                                κλάσης Registration (στοιχεία του client που 
                                απαιντούνται για σύνδεση στον AM/server).